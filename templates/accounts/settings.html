{% extends "base.html" %}

{% block title %}設定 - HPB Blog Automation{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto px-6 lg:px-8 py-10">
    <!-- Header -->
    <header class="mb-10">
        <h1 class="text-display text-gray-900 mb-2">設定</h1>
        <p class="text-body text-gray-500">アカウントとSALON BOARD連携の設定を管理します</p>
    </header>
    
    <!-- Profile Section -->
    <section class="card mb-8">
        <h2 class="text-title text-gray-900 mb-6">プロフィール</h2>
        
        <form method="post" class="space-y-6">
            {% csrf_token %}
            <input type="hidden" name="action" value="update_profile">
            
            <div>
                <label class="block text-body font-medium text-gray-700 mb-2">
                    メールアドレス
                </label>
                <input type="email" value="{{ user.email }}" disabled
                       class="w-full bg-gray-50 cursor-not-allowed text-gray-500">
                <p class="text-caption text-gray-400 mt-1.5">メールアドレスは変更できません</p>
            </div>
            
            <div>
                <label for="hpb_salon_url" class="block text-body font-medium text-gray-700 mb-2">
                    HPB サロンURL
                </label>
                <input type="url" id="hpb_salon_url" name="hpb_salon_url"
                       value="{{ user.hpb_salon_url|default:'' }}"
                       placeholder="https://beauty.hotpepper.jp/slnH000XXXXXX/">
                <p class="text-caption text-gray-400 mt-1.5">
                    Hot Pepper BeautyのサロンページURLを入力してください。スタイリストやクーポン情報の自動取得に使用します。
                </p>
            </div>
            
            {% if user.hpb_salon_id %}
            <div>
                <label class="block text-body font-medium text-gray-700 mb-2">
                    サロンID（自動抽出）
                </label>
                <input type="text" value="{{ user.hpb_salon_id }}" disabled
                       class="w-full bg-gray-50 cursor-not-allowed text-gray-500">
            </div>
            {% endif %}
            
            <button type="submit" class="btn btn-primary">
                プロフィールを更新
            </button>
        </form>
    </section>
    
    <!-- SALON BOARD Section -->
    <section class="card mb-8">
        <h2 class="text-title text-gray-900 mb-6">SALON BOARD 連携</h2>
        
        {% if salon_account %}
        <!-- Existing Account -->
        <div class="mb-6 p-4 rounded-lg bg-green-50 border border-green-200">
            <div class="flex items-center space-x-3">
                <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <div>
                    <p class="text-body font-medium text-green-700">連携済み</p>
                    <p class="text-caption text-green-600">ログインID: {{ salon_account.login_id }}</p>
                </div>
            </div>
        </div>
        {% endif %}
        
        <form method="post" class="space-y-6">
            {% csrf_token %}
            <input type="hidden" name="action" value="update_salon_board">
            
            <div>
                <label for="login_id" class="block text-body font-medium text-gray-700 mb-2">
                    SALON BOARD ログインID
                </label>
                <input type="text" id="login_id" name="login_id"
                       value="{{ salon_account.login_id|default:'' }}"
                       placeholder="ログインID">
            </div>
            
            <div>
                <label for="password" class="block text-body font-medium text-gray-700 mb-2">
                    パスワード
                </label>
                <input type="password" id="password" name="password"
                       autocomplete="new-password"
                       placeholder="{% if salon_account %}変更する場合のみ入力{% else %}パスワード{% endif %}">
                {% if salon_account %}
                <p class="text-caption text-gray-400 mt-1.5">変更する場合のみ入力してください</p>
                {% endif %}
            </div>
            
            <div class="p-4 rounded-lg bg-yellow-50 border border-yellow-200">
                <div class="flex items-start space-x-3">
                    <svg class="w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                    </svg>
                    <div>
                        <p class="text-body font-medium text-yellow-800">セキュリティについて</p>
                        <p class="text-caption text-yellow-700 mt-1">
                            パスワードは暗号化されて保存されます。自動投稿のためにのみ使用され、第三者に共有されることはありません。
                        </p>
                    </div>
                </div>
            </div>
            
            <div class="flex flex-col sm:flex-row gap-4">
                <button type="submit" class="btn btn-primary">
                    {% if salon_account %}更新{% else %}連携{% endif %}
                </button>
                
                {% if salon_account %}
                <button type="submit" name="action" value="delete_salon_board" 
                        class="btn btn-danger"
                        onclick="return confirm('SALON BOARD連携を解除しますか？')">
                    連携解除
                </button>
                {% endif %}
            </div>
        </form>
    </section>
    
    <!-- Account Actions -->
    <section class="card">
        <h2 class="text-title text-gray-900 mb-6">アカウント</h2>
        
        <a href="{% url 'accounts:logout' %}" class="btn btn-secondary inline-flex items-center">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
            </svg>
            ログアウト
        </a>
    </section>
</div>
{% endblock %}
